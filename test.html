<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Rank Checker</title>
    <!-- Content Security Policy (CSP) to allow inline scripts and external scripts from cdnjs -->
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com;">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.2/xlsx.full.min.js"></script>
</head>
<body>
    <h1>5th Sem. (2021-25) Rank Check</h1>
    <h4>in All Your Civil Engg. Batchmates in Bihar Engineering University</h4>

    <h2>Enter Registration Number</h2>
    <form id="regForm">
        <label for="reg_no">Registration Number:</label>
        <input type="text" id="reg_no" name="reg_no" required>
        <button type="button" id="fetchResultButton">Show Result</button>
    </form>

    <div id="resultSection" style="display: none;">
        <h3>Result:</h3>
        <div id="result">
            <!-- Result will be displayed here -->
        </div>
    </div>

    <script>
        const fileUrl = 'https://raw.githubusercontent.com/ErAbhishekKumar/erabhishekkumar.github.io/main/all_college_results.xlsx';

        // Fetch the Excel file from GitHub
        async function fetchExcelData() {
            const response = await fetch(fileUrl);
            const data = await response.arrayBuffer();
            const workbook = XLSX.read(data, { type: 'array' });
            const sheet = workbook.Sheets[workbook.SheetNames[0]]; // Assuming data is in the first sheet
            const jsonData = XLSX.utils.sheet_to_json(sheet, { header: 1 }); // Using header: 1 to ensure the first row is headers
            return jsonData;
        }

        // Handle button click
        document.getElementById('fetchResultButton').addEventListener('click', async function() {
            const regNo = document.getElementById('reg_no').value;

            if (!regNo.trim()) {
                alert('Please enter a registration number.');
                return;
            }

            const data = await fetchExcelData();
            const studentData = data.slice(1); // Removing the first row (headers)

            const student = studentData.find(row => row[0] == regNo); // Assuming registration number is in the first column
            
            if (student) {
                const name = student[1];  // Name is in the second column
                const sgpa = student[2];  // SGPA is in the third column

                const totalStudents = studentData.length;
                const rank = studentData.filter(row => row[2] >= sgpa).length; // Students with equal or higher SGPA
                const sameSgpaCount = studentData.filter(row => row[2] == sgpa).length;

                document.getElementById('result').innerHTML = `
                    <p>Name: ${name}</p>
                    <p>Rank: ${rank} / ${totalStudents}</p>
                    <p>SGPA: ${sgpa}</p>
                    <p>Number of students with the same SGPA: ${sameSgpaCount}</p>
                `;

                document.getElementById('resultSection').style.display = 'block'; // Show the result section
            } else {
                document.getElementById('result').innerHTML = '<p>No student found with this Registration Number.</p>';
                document.getElementById('resultSection').style.display = 'block'; // Show the result section
            }
        });
    </script>
</body>
</html>
